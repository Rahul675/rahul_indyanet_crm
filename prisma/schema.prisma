generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Customer {
  id               String   @id @default(cuid())
  fullName         String
  contactNumber    String
  servicesType     String
  connectionStatus String   @default("Active")
  installDate      DateTime
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  customerCode     String   @unique
  totalSpent       Float    @default(0)
  additionalInfo   Json     @default("{}")
  paymentMode      String?
  issues           Issue[]  @relation("CustomerIssues")

  @@index([connectionStatus])
  @@index([installDate])
  @@map("customers")
}

model Cluster {
  id                String      @id @default(uuid())
  name              String
  createdAt         DateTime    @default(now())
  status            String      @default("Active")
  updatedAt         DateTime    @updatedAt
  assignedOperators String[]    @default([])
  loadshares        LoadShare[]
  recharges         Recharge[]

  @@map("clusters")
}

model Issue {
  id              String    @id @default(cuid())
  category        String
  description     String
  status          String    @default("Pending")
  assignee        String?
  createdDate     DateTime  @default(now())
  resolvedDate    DateTime?
  resolutionNotes String?
  customerId      String
  updatedAt       DateTime  @updatedAt
  customer        Customer  @relation("CustomerIssues", fields: [customerId], references: [id], onDelete: Cascade)

  @@index([customerId])
  @@index([status])
  @@map("issues")
}

model Recharge {
  id            String         @id @default(cuid())
  planType      String
  rechargeDate  DateTime
  amount        Float
  validityDays  Int
  expiryDate    DateTime
  status        String         @default("Active")
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  paymentMethod String?
  remarks       String?
  transactionId String?
  clusterId     String?
  loadshareId   String?
  notifications Notification[]
  cluster       Cluster?       @relation(fields: [clusterId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  loadshare     LoadShare?     @relation(fields: [loadshareId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([clusterId])
  @@index([loadshareId])
  @@index([rechargeDate])
  @@map("recharges")
}

model LoadShare {
  id                  String     @id @default(cuid())
  nameOfLocation      String
  address             String
  state               String
  circuitId           String
  isp                 String
  rtNumber            String     @unique
  invoice             String?
  speed               String
  status              String     @default("Active")
  validity            Int
  paidBy              String
  activationDate      DateTime?
  expiryDate          DateTime?
  installationCharges Float
  internetCharges     Float
  gstPercent          Float
  gstAmount           Float
  totalPayable        Float
  month               String
  requestedBy         String
  approvedFrom        String
  wifiOrNumber        String?
  hubSpocName         String?
  hubSpocNumber       String?
  createdAt           DateTime   @default(now())
  updatedAt           DateTime   @updatedAt
  clusterId           String
  cluster             Cluster    @relation(fields: [clusterId], references: [id], onDelete: Cascade)
  recharges           Recharge[]

  @@index([nameOfLocation])
  @@index([clusterId])
  @@map("loadshare")
}

model OtherClient {
  id                   String    @id @default(cuid())
  site                 String
  lanIp                String?
  remarks              String?
  macId                String?
  landlineWifiId       String?
  speedMbps            String?
  installationDate     DateTime?
  contactNo            String?
  dvrConnected         String?
  simNo                String?
  deviceName           String?
  deviceLicense        String?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt
  aValue               String?
  dispatchDate         DateTime?
  internetInstallation String?
  isp1                 String?
  isp2                 String?
  prevBillReceived     String?
  publicIp1            String?
  publicIp2            String?
  reachedDayDate       DateTime?

  @@index([site])
  @@map("other_clients")
}

model User {
  id            String         @id @default(cuid())
  name          String
  email         String         @unique
  password      String
  isOnline      Boolean        @default(false)
  lastActiveAt  DateTime       @default(now())
  role          String         @default("operator")
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  lastLoginAt   DateTime?
  lastLogoutAt  DateTime?
  logoutReason  String?
  auditLogs     AuditLog[]
  notifications Notification[]

  @@index([email])
  @@index([role])
  @@map("users")
}

model AuditLog {
  id        String   @id @default(cuid())
  action    String
  entity    String
  detail    String?
  createdAt DateTime @default(now())
  userId    String?
  user      User?    @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([action])
  @@map("audit_logs")
}

model Notification {
  id         String    @id @default(cuid())
  userId     String?
  rechargeId String?
  type       String
  message    String
  read       Boolean   @default(false)
  createdAt  DateTime  @default(now())
  recharge   Recharge? @relation(fields: [rechargeId], references: [id], onDelete: Cascade)
  user       User?     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([rechargeId])
  @@index([type])
  @@map("notifications")
}
